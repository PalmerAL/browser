var textFragmentUtils=function(u){"use strict";const e=["text"],t=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],n=/[\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,F="text-fragments-polyfill-target-text",D=u=>{const e=/^(?:(.+?)-,)?(?:(.+?))(?:,([^-]+?))?(?:,-(.+?))?$/;return{prefix:decodeURIComponent(u.replace(e,"$1")),textStart:decodeURIComponent(u.replace(e,"$2")),textEnd:decodeURIComponent(u.replace(e,"$3")),suffix:decodeURIComponent(u.replace(e,"$4"))}},o=u=>{const e=[],t=document.createRange();for(t.selectNodeContents(document.body);!t.collapsed&&e.length<2;){let n;if(u.prefix){const e=i(u.prefix,t);if(null==e)break;a(t,e.startContainer,e.startOffset);const F=document.createRange();if(F.setStart(e.endContainer,e.endOffset),F.setEnd(t.endContainer,t.endOffset),E(F),F.collapsed)break;if(n=i(u.textStart,F),null==n)break;if(0!==n.compareBoundaryPoints(Range.START_TO_START,F))continue}else{if(n=i(u.textStart,t),null==n)break;a(t,n.startContainer,n.startOffset)}if(u.textEnd){const F=document.createRange();for(F.setStart(n.endContainer,n.endOffset),F.setEnd(t.endContainer,t.endOffset);!F.collapsed&&e.length<2;){const D=i(u.textEnd,F);if(null==D)break;if(a(F,D.startContainer,D.startOffset),n.setEnd(D.endContainer,D.endOffset),u.suffix){const F=s(u.suffix,n,t);if(F===r.NO_SUFFIX_MATCH)break;if(F===r.SUFFIX_MATCH){e.push(n.cloneRange());continue}if(F===r.MISPLACED_SUFFIX)continue}else e.push(n.cloneRange())}}else if(u.suffix){const F=s(u.suffix,n,t);if(F===r.NO_SUFFIX_MATCH)break;if(F===r.SUFFIX_MATCH){e.push(n.cloneRange()),a(t,t.startContainer,t.startOffset);continue}if(F===r.MISPLACED_SUFFIX)continue}else e.push(n.cloneRange())}return e},r={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},s=(u,e,t)=>{const n=document.createRange();n.setStart(e.endContainer,e.endOffset),n.setEnd(t.endContainer,t.endOffset),E(n);const F=i(u,n);return null==F?r.NO_SUFFIX_MATCH:0!==F.compareBoundaryPoints(Range.START_TO_START,n)?r.MISPLACED_SUFFIX:r.SUFFIX_MATCH},a=(u,e,t)=>{try{u.setStart(e,t+1)}catch(t){u.setStartAfter(e)}},E=u=>{const e=document.createTreeWalker(u.commonAncestorContainer,NodeFilter.SHOW_TEXT,(e=>C(e,u)));let t=e.nextNode();for(;!u.collapsed&&null!=t;){if(t!==u.startContainer&&u.setStart(t,0),t.textContent.length>u.startOffset){if(!t.textContent[u.startOffset].match(n))return}try{u.setStart(t,u.startOffset+1)}catch(n){t=e.nextNode(),null==t?u.collapse():u.setStart(t,0)}}},A=u=>{if(u.startContainer.nodeType!=Node.TEXT_NODE||u.endContainer.nodeType!=Node.TEXT_NODE)return[];if(u.startContainer===u.endContainer){const e=document.createElement("mark");return e.setAttribute("class",F),u.surroundContents(e),[e]}const e=u.startContainer,n=u.cloneRange();n.setEndAfter(e);const D=u.endContainer,o=u.cloneRange();o.setStartBefore(D);const r=[];u.setStartAfter(e),u.setEndBefore(D);const s=document.createTreeWalker(u.commonAncestorContainer,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function(e){return u.intersectsNode(e)?t.includes(e.tagName)||e.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}});let a=s.nextNode();for(;a;){if(a.nodeType===Node.TEXT_NODE){const u=document.createElement("mark");u.setAttribute("class",F),a.parentNode.insertBefore(u,a),u.appendChild(a),r.push(u)}a=s.nextNode()}const E=document.createElement("mark");E.setAttribute("class",F),n.surroundContents(E);const A=document.createElement("mark");return A.setAttribute("class",F),o.surroundContents(A),[E,...r,A]},C=(u,e)=>{if(null!=e&&!e.intersectsNode(u))return NodeFilter.FILTER_REJECT;let t=u;for(;null!=t&&!(t instanceof HTMLElement);)t=t.parentNode;if(null!=t){const u=window.getComputedStyle(t);if("hidden"===u.visibility||"none"===u.display||0===u.height||0===u.width||0===u.opacity)return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT},c=(u,e)=>{const n=[];let F=[];const D=Array.from(function*(u,e){const t=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:e});let n;for(;n=t.nextNode();)yield n}(u,(u=>C(u,e))));for(const u of D)u.nodeType===Node.TEXT_NODE?F.push(u):u instanceof HTMLElement&&t.includes(u.tagName)&&F.length>0&&(n.push(F),F=[]);return F.length>0&&n.push(F),n};const i=(u,e)=>{const t=c(e.commonAncestorContainer,e);for(const n of t){const t=l(u,e,n);if(void 0!==t)return t}},l=(u,e,t)=>{if(!u||!e||!(t||[]).length)return;const n=T(((u,e,t)=>{let n="";return n=1===u.length?u[0].textContent.substring(e,t):u[0].textContent.substring(e)+u.slice(1,-1).reduce(((u,e)=>u+e.textContent),"")+u.slice(-1)[0].textContent.substring(0,t),n.replace(/[\t\n\r ]+/g," ")})(t,0,void 0)),F=T(u);let D,o,r=t[0]===e.startNode?e.startOffset:0;for(;r<n.length;){const u=n.indexOf(F,r);if(-1===u)return;if(f(n,u,F.length)&&(D=d(u,t,!1),o=d(u+F.length,t,!0)),null!=D&&null!=o){const u=document.createRange();if(u.setStart(D.node,D.offset),u.setEnd(o.node,o.offset),e.compareBoundaryPoints(Range.START_TO_START,u)<=0&&e.compareBoundaryPoints(Range.END_TO_END,u)>=0)return u}r=u+1}},d=(u,e,t)=>{let n,F=0;for(let D=0;D<e.length;D++){const o=e[D];n||(n=T(o.data));let r=F+n.length;if(t&&(r+=1),r>u){const e=u-F;let D=Math.min(u-F,o.data.length);const r=t?n.substring(0,e):n.substring(e);let s=T(t?o.data.substring(0,D):o.data.substring(D));const a=(t?-1:1)*(r.length>s.length?-1:1);for(;D>=0&&D<=o.data.length;){if(s.length===r.length)return{node:o,offset:D};D+=a,s=T(t?o.data.substring(0,D):o.data.substring(D))}}if(F+=n.length,D+1<e.length){const u=T(e[D+1].data);" "===n.slice(-1)&&" "===u.slice(0,1)&&(F-=1),n=u}}},f=(u,e,t)=>!(e<0||e>=u.length||t<=0||e+t>u.length)&&(!(u[e].match(n)&&(++e,!--t))&&(!(u[e+t-1].match(n)&&!--t)&&(!(0!==e&&!u[e-1].match(n))&&!(e+t!==u.length&&!u[e+t].match(n))))),T=u=>(u||"").normalize("NFKD").replace(/\s+/g," ").replace(/[\u0300-\u036f]/g,"").toLowerCase(),g={advanceRangeStartPastOffset:a,advanceRangeStartToNonBoundary:E,findRangeFromNodeList:l,findTextInRange:i,getBoundaryPointAtIndex:d,isWordBounded:f,markRange:A,normalizeString:T,parseTextFragmentDirective:D},B={BLOCK_ELEMENTS:t,BOUNDARY_CHARS:n,NON_BOUNDARY_CHARS:/[^\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,filterFunction:C,normalizeString:T};"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.textFragmentUtils");const m=()=>{const u=document.getElementsByTagName("style");if(u)for(const e of u){const u=e.innerHTML.match(/(\w*)::target-text\s*{\s*((.|\n)*?)\s*}/g);if(!u)continue;const t=u.join("\n"),n=document.createTextNode(t.replaceAll("::target-text",` .${F}`));e.appendChild(n)}};return u.TEXT_FRAGMENT_CSS_CLASS_NAME=F,u.applyTargetTextStyle=m,u.forTesting=g,u.getFragmentDirectives=u=>{const e=u.replace(/#.*?:~:(.*?)/,"$1").split(/&?text=/).filter(Boolean);return e.length?{text:e}:{}},u.internal=B,u.markRange=A,u.parseFragmentDirectives=u=>{const t={};for(const[n,F]of Object.entries(u))e.includes(n)&&(t[n]=F.map((u=>D(u))));return t},u.processFragmentDirectives=u=>{const t={};for(const[n,F]of Object.entries(u))e.includes(n)&&(t[n]=F.map((u=>{const e=o(u);return 1===e.length?A(e[0]):[]})));return t},u.processTextFragmentDirective=o,u.removeMarks=u=>{for(const e of u){const u=document.createRange();u.selectNodeContents(e);const t=u.extractContents(),n=e.parentNode;n.insertBefore(t,e),n.removeChild(e)}},u.scrollElementIntoView=u=>{u.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})},u.setDefaultTextFragmentsStyle=({backgroundColor:u,color:e})=>{const t=document.getElementsByTagName("style"),n=`.${F} {\n    background-color: ${u};\n    color: ${e};\n  }`;if(0===t.length)document.head.insertAdjacentHTML("beforeend",`<style type="text/css">${n}</style>`);else{m();const u=document.createTextNode(n);t[0].insertBefore(u,t[0].firstChild)}},Object.defineProperty(u,"__esModule",{value:!0}),u}({});
