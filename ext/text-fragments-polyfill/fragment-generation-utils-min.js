var textFragmentGenerationUtils=function(t){"use strict";const e=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],u=/[\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,n={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},r=(t,e,u)=>{const r=document.createRange();r.setStart(e.endContainer,e.endOffset),r.setEnd(u.endContainer,u.endOffset),a(r);const s=f(t,r);return null==s?n.NO_SUFFIX_MATCH:0!==s.compareBoundaryPoints(Range.START_TO_START,r)?n.MISPLACED_SUFFIX:n.SUFFIX_MATCH},s=(t,e,u)=>{try{t.setStart(e,u+1)}catch(u){t.setStartAfter(e)}},a=t=>{const e=document.createTreeWalker(t.commonAncestorContainer,NodeFilter.SHOW_TEXT,(e=>i(e,t)));let n=e.nextNode();for(;!t.collapsed&&null!=n;){if(n!==t.startContainer&&t.setStart(n,0),n.textContent.length>t.startOffset){if(!n.textContent[t.startOffset].match(u))return}try{t.setStart(n,t.startOffset+1)}catch(u){n=e.nextNode(),null==n?t.collapse():t.setStart(n,0)}}},i=(t,e)=>{if(null!=e&&!e.intersectsNode(t))return NodeFilter.FILTER_REJECT;let u=t;for(;null!=u&&!(u instanceof HTMLElement);)u=u.parentNode;if(null!=u){const t=window.getComputedStyle(u);if("hidden"===t.visibility||"none"===t.display||0===t.height||0===t.width||0===t.opacity)return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT},o=(t,u)=>{const n=[];let r=[];const s=Array.from(function*(t,e){const u=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:e});let n;for(;n=u.nextNode();)yield n}(t,(t=>i(t,u))));for(const t of s)t.nodeType===Node.TEXT_NODE?r.push(t):t instanceof HTMLElement&&e.includes(t.tagName)&&r.length>0&&(n.push(r),r=[]);return r.length>0&&n.push(r),n};const f=(t,e)=>{const u=o(e.commonAncestorContainer,e);for(const n of u){const u=c(t,e,n);if(void 0!==u)return u}},c=(t,e,u)=>{if(!t||!e||!(u||[]).length)return;const n=d(((t,e,u)=>{let n="";return n=1===t.length?t[0].textContent.substring(e,u):t[0].textContent.substring(e)+t.slice(1,-1).reduce(((t,e)=>t+e.textContent),"")+t.slice(-1)[0].textContent.substring(0,u),n.replace(/[\t\n\r ]+/g," ")})(u,0,void 0)),r=d(t);let s,a,i=u[0]===e.startNode?e.startOffset:0;for(;i<n.length;){const t=n.indexOf(r,i);if(-1===t)return;if(F(n,t,r.length)&&(s=D(t,u,!1),a=D(t+r.length,u,!0)),null!=s&&null!=a){const t=document.createRange();if(t.setStart(s.node,s.offset),t.setEnd(a.node,a.offset),e.compareBoundaryPoints(Range.START_TO_START,t)<=0&&e.compareBoundaryPoints(Range.END_TO_END,t)>=0)return t}i=t+1}},D=(t,e,u)=>{let n,r=0;for(let s=0;s<e.length;s++){const a=e[s];n||(n=d(a.data));let i=r+n.length;if(u&&(i+=1),i>t){const e=t-r;let s=Math.min(t-r,a.data.length);const i=u?n.substring(0,e):n.substring(e);let o=d(u?a.data.substring(0,s):a.data.substring(s));const f=(u?-1:1)*(i.length>o.length?-1:1);for(;s>=0&&s<=a.data.length;){if(o.length===i.length)return{node:a,offset:s};s+=f,o=d(u?a.data.substring(0,s):a.data.substring(s))}}if(r+=n.length,s+1<e.length){const t=d(e[s+1].data);" "===n.slice(-1)&&" "===t.slice(0,1)&&(r-=1),n=t}}},F=(t,e,n)=>!(e<0||e>=t.length||n<=0||e+n>t.length)&&(!(t[e].match(u)&&(++e,!--n))&&(!(t[e+n-1].match(u)&&!--n)&&(!(0!==e&&!t[e-1].match(u))&&!(e+n!==t.length&&!t[e+n].match(u))))),d=t=>(t||"").normalize("NFKD").replace(/\s+/g," ").replace(/[\u0300-\u036f]/g,"").toLowerCase(),h={BLOCK_ELEMENTS:e,BOUNDARY_CHARS:u,NON_BOUNDARY_CHARS:/[^\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,filterFunction:i,normalizeString:d};"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.textFragmentUtils");let E,l=500;const S={SUCCESS:0,INVALID_SELECTION:1,AMBIGUOUS:2,TIMEOUT:3},A=(t,e)=>{let u,n;g(e);try{u=t.getRangeAt(0)}catch{return{status:S.INVALID_SELECTION}}if(L(u),k(u),u.collapsed)return{status:S.INVALID_SELECTION};const r=h.normalizeString(u.toString());if(_(u)){const t={textStart:r};if(p(t))return{status:S.SUCCESS,fragment:t};n=(new T).setExactTextMatch(r)}else{const t=O(u),e=N(u);n=t&&e?(new T).setStartAndEndSearchSpace(t,e):(new T).setSharedSearchSpace(x(u.toString()))}const s=document.createRange();s.selectNodeContents(document.body);const a=s.cloneRange();s.setEnd(u.startContainer,u.startOffset),a.setStart(u.endContainer,u.endOffset);const i=N(s),o=O(a);for(i&&o&&n.setPrefixAndSuffixSearchSpace(i,o);n.embiggen();){const t=n.tryToMakeUniqueFragment();if(null!=t)return{status:S.SUCCESS,fragment:t};C()}return{status:S.AMBIGUOUS}},C=()=>{const t=Date.now()-E;if(t>l){const e=new Error(`Fragment generation timed out after ${t} ms.`);throw e.isTimeout=!0,e}},g=t=>{E=t},O=t=>{let e=R(t);const u=w(e,t.endContainer);if(!u)return;const n=H(u),r=e,s=t.cloneRange();for(;!s.collapsed&&null!=e;){if(C(),e.contains(r)?s.setStartAfter(e):s.setStartBefore(e),y(e)){const e=t.cloneRange();e.setEnd(s.startContainer,s.startOffset);const u=x(e.toString());if(u.length>0)return u}e=P(u,n)}},N=t=>{let e=m(t);const u=w(e,t.startContainer);if(!u)return;const n=new Set,r=e,s=t.cloneRange();for(;!s.collapsed&&null!=e;){if(C(),e.contains(r)?s.setEnd(e,0):s.setEndAfter(e),y(e)){const e=t.cloneRange();e.setStart(s.endContainer,s.endOffset);const u=x(e.toString());if(u.length>0)return u}e=U(u,n,r)}},T=class{constructor(){this.Mode={ALL_PARTS:1,SHARED_START_AND_END:2,CONTEXT_ONLY:3},this.startOffset=null,this.endOffset=null,this.prefixOffset=null,this.suffixOffset=null,this.prefixSearchSpace="",this.backwardsPrefixSearchSpace="",this.suffixSearchSpace="",this.numIterations=0}tryToMakeUniqueFragment(){let t;if(t=this.mode===this.Mode.CONTEXT_ONLY?{textStart:this.exactTextMatch}:{textStart:x(this.getStartSearchSpace().substring(0,this.startOffset)),textEnd:x(this.getEndSearchSpace().substring(this.endOffset))},null!=this.prefixOffset){const e=x(this.getPrefixSearchSpace().substring(this.prefixOffset));e&&(t.prefix=e)}if(null!=this.suffixOffset){const e=x(this.getSuffixSearchSpace().substring(0,this.suffixOffset));e&&(t.suffix=e)}return p(t)?t:void 0}embiggen(){let t=!0;this.mode===this.Mode.SHARED_START_AND_END?this.startOffset>=this.endOffset&&(t=!1):this.mode===this.Mode.ALL_PARTS?this.startOffset===this.getStartSearchSpace().length&&this.backwardsEndOffset()===this.getEndSearchSpace().length&&(t=!1):this.mode===this.Mode.CONTEXT_ONLY&&(t=!1);let e=!1;if((!t||this.numIterations>=3)&&(null!=this.backwardsPrefixOffset()&&this.backwardsPrefixOffset()!==this.getPrefixSearchSpace().length||null!=this.suffixOffset&&this.suffixOffset!==this.getSuffixSearchSpace().length)&&(e=!0),t){if(this.startOffset<this.getStartSearchSpace().length){const t=this.getStartSearchSpace().substring(this.startOffset+1).search(h.BOUNDARY_CHARS);this.startOffset=-1===t?this.getStartSearchSpace().length:this.startOffset+1+t,this.mode===this.Mode.SHARED_START_AND_END&&(this.startOffset=Math.min(this.startOffset,this.endOffset))}if(this.backwardsEndOffset()<this.getEndSearchSpace().length){const t=this.getBackwardsEndSearchSpace().substring(this.backwardsEndOffset()+1).search(h.BOUNDARY_CHARS);-1===t?this.setBackwardsEndOffset(this.getEndSearchSpace().length):this.setBackwardsEndOffset(this.backwardsEndOffset()+1+t),this.mode===this.Mode.SHARED_START_AND_END&&(this.endOffset=Math.max(this.startOffset,this.endOffset))}}if(e){if(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length){const t=this.getBackwardsPrefixSearchSpace().substring(this.backwardsPrefixOffset()+1).search(h.BOUNDARY_CHARS);-1===t?this.setBackwardsPrefixOffset(this.getBackwardsPrefixSearchSpace().length):this.setBackwardsPrefixOffset(this.backwardsPrefixOffset()+1+t)}if(this.suffixOffset<this.getSuffixSearchSpace().length){const t=this.getSuffixSearchSpace().substring(this.suffixOffset+1).search(h.BOUNDARY_CHARS);this.suffixOffset=-1===t?this.getSuffixSearchSpace().length:this.suffixOffset+1+t}}return this.numIterations++,t||e}setStartAndEndSearchSpace(t,e){return this.startSearchSpace=t,this.endSearchSpace=e,this.backwardsEndSearchSpace=B(e),this.startOffset=0,this.endOffset=e.length,this.mode=this.Mode.ALL_PARTS,this}setSharedSearchSpace(t){return this.sharedSearchSpace=t,this.backwardsSharedSearchSpace=B(t),this.startOffset=0,this.endOffset=t.length,this.mode=this.Mode.SHARED_START_AND_END,this}setExactTextMatch(t){return this.exactTextMatch=t,this.mode=this.Mode.CONTEXT_ONLY,this}setPrefixAndSuffixSearchSpace(t,e){return this.prefixSearchSpace=t,this.backwardsPrefixSearchSpace=B(t),this.prefixOffset=t.length,this.suffixSearchSpace=e,this.suffixOffset=0,this}getStartSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.startSearchSpace}getEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.endSearchSpace}getBackwardsEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.backwardsSharedSearchSpace:this.backwardsEndSearchSpace}getPrefixSearchSpace(){return this.prefixSearchSpace}getBackwardsPrefixSearchSpace(){return this.backwardsPrefixSearchSpace}getSuffixSearchSpace(){return this.suffixSearchSpace}backwardsEndOffset(){return this.getEndSearchSpace().length-this.endOffset}setBackwardsEndOffset(t){this.endOffset=this.getEndSearchSpace().length-t}backwardsPrefixOffset(){return null==this.prefixOffset?null:this.getPrefixSearchSpace().length-this.prefixOffset}setBackwardsPrefixOffset(t){null!=this.prefixOffset&&(this.prefixOffset=this.getPrefixSearchSpace().length-t)}},p=t=>1===(t=>{const e=[],u=document.createRange();for(u.selectNodeContents(document.body);!u.collapsed&&e.length<2;){let i;if(t.prefix){const e=f(t.prefix,u);if(null==e)break;s(u,e.startContainer,e.startOffset);const n=document.createRange();if(n.setStart(e.endContainer,e.endOffset),n.setEnd(u.endContainer,u.endOffset),a(n),n.collapsed)break;if(i=f(t.textStart,n),null==i)break;if(0!==i.compareBoundaryPoints(Range.START_TO_START,n))continue}else{if(i=f(t.textStart,u),null==i)break;s(u,i.startContainer,i.startOffset)}if(t.textEnd){const a=document.createRange();for(a.setStart(i.endContainer,i.endOffset),a.setEnd(u.endContainer,u.endOffset);!a.collapsed&&e.length<2;){const o=f(t.textEnd,a);if(null==o)break;if(s(a,o.startContainer,o.startOffset),i.setEnd(o.endContainer,o.endOffset),t.suffix){const s=r(t.suffix,i,u);if(s===n.NO_SUFFIX_MATCH)break;if(s===n.SUFFIX_MATCH){e.push(i.cloneRange());continue}if(s===n.MISPLACED_SUFFIX)continue}else e.push(i.cloneRange())}}else if(t.suffix){const a=r(t.suffix,i,u);if(a===n.NO_SUFFIX_MATCH)break;if(a===n.SUFFIX_MATCH){e.push(i.cloneRange()),s(u,u.startContainer,u.startOffset);continue}if(a===n.MISPLACED_SUFFIX)continue}else e.push(i.cloneRange())}return e})(t).length,x=t=>{const e=t.search(h.NON_BOUNDARY_CHARS);let u=B(t).search(h.NON_BOUNDARY_CHARS);return-1!==u&&(u=t.length-u),-1===e||-1===u||e>=u?"":t.substring(e,u)},B=t=>[...t||""].reverse().join(""),_=t=>!(t.toString().length>300)&&!b(t),R=t=>{let e=t.startContainer;return e.nodeType==Node.ELEMENT_NODE&&t.startOffset<e.childNodes.length&&(e=e.childNodes[t.startOffset]),e},m=t=>{let e=t.endContainer;return e.nodeType==Node.ELEMENT_NODE&&t.endOffset>0&&(e=e.childNodes[t.endOffset-1]),e},b=t=>{const e=t.cloneRange();let u=R(e);const n=w(u);if(!n)return!1;const r=H(n);for(;!e.collapsed&&null!=u;){if(y(u))return!0;null!=u&&e.setStartAfter(u),u=P(n,r),C()}return!1},M=(t,e)=>{if(t.nodeType!==Node.TEXT_NODE)return-1;const u=null!=e?e:t.data.length;if(u<t.data.length&&h.BOUNDARY_CHARS.test(t.data[u]))return u;const n=t.data.substring(0,u),r=B(n).search(h.BOUNDARY_CHARS);return-1!==r?u-r:-1},I=(t,e)=>{if(t.nodeType!==Node.TEXT_NODE)return-1;const u=null!=e?e:0;if(u<t.data.length&&u>0&&h.BOUNDARY_CHARS.test(t.data[u-1]))return u;const n=t.data.substring(u).search(h.BOUNDARY_CHARS);return-1!==n?u+n:-1},w=(t,e)=>{if(!t)return;let u=t;const n=null!=e?e:t;for(;!u.contains(n)||!y(u);)u.parentNode&&(u=u.parentNode);const r=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,(t=>h.filterFunction(t)));return r.currentNode=t,r},L=t=>{const e=M(t.startContainer,t.startOffset);if(-1!==e)return void t.setStart(t.startContainer,e);if(y(t.startContainer)&&0===t.startOffset)return;const u=w(t.startContainer);if(!u)return;const n=new Set,r=u.currentNode;let s=U(u,n,r);for(;null!=s;){const e=M(s);if(-1!==e)return void t.setStart(s,e);if(y(s))return void(s.contains(t.startContainer)?t.setStart(s,0):t.setStartAfter(s));s=U(u,n,r)}t.collapse()},H=t=>{const e=t.currentNode,u=new Set,n=new Map;do{const e=t.currentNode;for(u.add(e);null!=t.lastChild()&&!u.has(t.currentNode););t.currentNode!==e&&n.set(t.currentNode,e),n.set(e,t.nextNode()),t.currentNode=e}while(null!=t.parentNode());return t.currentNode=e,n},P=(t,e)=>{if(e.has(t.currentNode)){const u=e.get(t.currentNode);return null!=u&&(t.currentNode=u),u}return t.nextNode()},U=(t,e,u)=>{for(;;){if(C(),!e.has(t.currentNode)&&!t.currentNode.contains(u)&&(e.add(t.currentNode),null!=t.lastChild()))return t.currentNode;if(null!=t.previousSibling())return t.currentNode;if(null==t.parentNode())return null;if(!e.has(t.currentNode))return t.currentNode}},k=t=>{let e=t.endOffset,u=t.endContainer;u.nodeType===Node.ELEMENT_NODE&&t.endOffset<u.childNodes.length&&(u=u.childNodes[t.endOffset]);const n=w(u);if(!n)return;const r=H(n);for(;null!=u;){C();const s=I(u,e);if(e=null,-1!==s)return void t.setEnd(u,s);if(y(u))return void(u.contains(t.endContainer)?t.setEnd(u,u.childNodes.length):t.setEndBefore(u));u=P(n,r)}t.collapse()},y=t=>t.nodeType===Node.ELEMENT_NODE&&(h.BLOCK_ELEMENTS.includes(t.tagName)||"HTML"===t.tagName||"BODY"===t.tagName),X={backwardTraverse:U,containsBlockBoundary:b,createForwardOverrideMap:H,doGenerateFragment:A,expandRangeEndToWordBound:k,expandRangeStartToWordBound:L,findWordEndBoundInTextNode:I,findWordStartBoundInTextNode:M,forwardTraverse:P,FragmentFactory:T,getSearchSpaceForEnd:N,getSearchSpaceForStart:O,recordStartTime:g,trimBoundary:x};return"undefined"!=typeof goog&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.fragmentGenerationUtils"),t.GenerateFragmentStatus=S,t.forTesting=X,t.generateFragment=(t,e=Date.now())=>{try{return A(t,e)}catch(t){return{status:S.TIMEOUT}}},t.isValidRangeForFragmentGeneration=t=>{if(!t.toString().substring(0,1e4).match(h.NON_BOUNDARY_CHARS))return!1;try{if(t.startContainer.ownerDocument.defaultView!==window.top)return!1}catch{return!1}let e=t.commonAncestorContainer,u=0;for(;e;){if(e.nodeType==Node.ELEMENT_NODE){if(["TEXTAREA","INPUT"].includes(e.tagName))return!1;const t=e.attributes.getNamedItem("contenteditable");if(t&&"false"!==t.value)return!1;if(u++,u>=500)return!1}e=e.parentNode}return!0},t.setTimeout=t=>{l=t},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
